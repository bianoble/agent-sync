{"config":{"lang":["en"],"separator":"[\\s\\-]+","pipeline":["stopWordFilter"],"fields":{"title":{"boost":1000.0},"text":{"boost":1.0},"tags":{"boost":1000000.0}}},"docs":[{"location":"","title":"agent-sync","text":"<p>Deterministic, registry-agnostic synchronization of agent files.</p> <p>agent-sync fetches files from external sources (Git repositories, URLs, local paths), pins them immutably via a lockfile, applies controlled transformations, and synchronizes them into tool-specific project locations.</p>"},{"location":"#key-features","title":"Key Features","text":"<ul> <li>Deterministic: Same inputs always produce byte-for-byte identical outputs</li> <li>Source types: Git repositories, URLs with checksum verification, local paths</li> <li>Tool map: Built-in support for Cursor, Claude Code, Copilot, Windsurf, Cline, and Codex</li> <li>Lockfile pinning: Immutable content hashes ensure reproducibility</li> <li>Transforms: Template variable substitution and file overrides</li> <li>Security: Sandbox enforcement, atomic writes, symlink traversal prevention</li> <li>Hierarchical config: System, user, and project configs merge automatically for org-wide policies</li> <li>CI-friendly: <code>check</code> and <code>verify</code> commands with structured exit codes</li> </ul>"},{"location":"#quick-example","title":"Quick Example","text":"<pre><code># agent-sync.yaml\nversion: 1\n\nsources:\n  - name: team-rules\n    type: git\n    repo: https://github.com/org/agent-rules.git\n    ref: v1.0.0\n\ntargets:\n  - source: team-rules\n    tools: [cursor, claude-code]\n</code></pre> <pre><code># Resolve sources and create lockfile\nagent-sync update\n\n# Sync files to tool directories\nagent-sync sync\n\n# Verify nothing has drifted\nagent-sync check\n</code></pre>"},{"location":"#next-steps","title":"Next Steps","text":"<ul> <li>Installation \u2014 Install the CLI</li> <li>Quick Start \u2014 Set up your first project</li> <li>Configuration Reference \u2014 Full config file documentation</li> <li>CLI Reference \u2014 All available commands</li> <li>Go Library \u2014 Use agent-sync as a Go library</li> <li>Enterprise &amp; DevSecOps \u2014 Hierarchical config, compliance, and deployment at scale</li> </ul>"},{"location":"spec/","title":"agent-sync Specification v0.4","text":"<p>This is the authoritative specification. The file <code>agent-sync-spec-v0.4.md</code> was a historical duplicate and has been removed.</p> <p>Status: Draft Audience: Library implementers, CLI authors, and platform integrators Scope: Deterministic synchronization of agent-related files from external sources into a project workspace. Non-Goals: Agent execution, registry hosting, agent runtime orchestration.</p>"},{"location":"spec/#1-overview","title":"1. Overview","text":""},{"location":"spec/#11-purpose","title":"1.1 Purpose","text":"<p><code>agent-sync</code> is a deterministic, registry-agnostic dependency and synchronization system for agent files.</p> <p>It enables projects to:</p> <ul> <li>Fetch agent files from external sources (Git, URL, local)</li> <li>Pin those files immutably</li> <li>Apply controlled transformations and overlays</li> <li>Safely synchronize them into tool-specific or project-specific locations</li> </ul> <p>Core principle:</p> <p>agent-sync manages files as immutable inputs and deterministic outputs</p> <p>It does not interpret agent semantics.</p>"},{"location":"spec/#12-design-goals","title":"1.2 Design Goals","text":""},{"location":"spec/#primary-goals","title":"Primary Goals","text":"<ul> <li>Deterministic</li> <li>Secure by default</li> <li>Registry-agnostic</li> <li>Tool-agnostic</li> <li>Minimal and composable</li> <li>Embeddable as a Go library</li> </ul>"},{"location":"spec/#secondary-goals","title":"Secondary Goals","text":"<ul> <li>Human-readable configuration</li> <li>Explicit updates only</li> <li>CI-friendly drift detection</li> </ul>"},{"location":"spec/#13-non-goals","title":"1.3 Non-Goals","text":"<p>agent-sync does NOT:</p> <ul> <li>Execute agents</li> <li>Interpret agent behavior</li> <li>Provide a registry (deferred)</li> <li>Replace configuration management tools</li> <li>Replace package managers</li> </ul>"},{"location":"spec/#2-conceptual-model","title":"2. Conceptual Model","text":"<p>agent-sync operates on four layers:</p> <pre><code>Sources \u2192 Locked Inputs \u2192 Transform \u2192 Target Files\n</code></pre>"},{"location":"spec/#21-sources","title":"2.1 Sources","text":"<p>Sources provide files.</p> <p>Supported source types:</p> <ul> <li>git</li> <li>url</li> <li>local</li> </ul> <p>Each source is resolved into an immutable artifact.</p>"},{"location":"spec/#22-lockfile","title":"2.2 Lockfile","text":"<p>The lockfile records the fully resolved, immutable state of all inputs.</p> <p>The lockfile guarantees:</p> <ul> <li>Reproducible sync</li> <li>Supply chain integrity</li> <li>Drift detection</li> </ul>"},{"location":"spec/#23-transform","title":"2.3 Transform","text":"<p>Optional transforms include:</p> <ul> <li>Template variable substitution</li> <li>Overlay merging</li> <li>File mapping</li> <li>Custom transform hooks</li> </ul> <p>Transforms MUST be deterministic.</p>"},{"location":"spec/#24-targets","title":"2.4 Targets","text":"<p>Targets define where files are written.</p> <p>Targets MUST remain inside the project root sandbox.</p> <p>Targets may be specified explicitly or derived from the tool map (see Section 3.2).</p>"},{"location":"spec/#3-configuration-file","title":"3. Configuration File","text":"<p>File name:</p> <pre><code>agent-sync.yaml\n</code></pre>"},{"location":"spec/#31-example","title":"3.1 Example","text":"<pre><code>version: 1\n\nvariables:\n  project: my-project\n  language: go\n\nsources:\n\n  - name: base-rules\n    type: git\n    repo: https://github.com/org/rules.git\n    ref: v1.2.0\n    paths:\n      - core/\n\n  - name: security-policy\n    type: url\n    url: https://example.com/policy.md\n    checksum: sha256:abcdef...\n\n  - name: team-standards\n    type: local\n    path: ./agents/standards/\n\ntargets:\n\n  - source: base-rules\n    tools: [cursor, claude-code, copilot]\n\n  - source: security-policy\n    tools: [cursor, claude-code]\n\n  - source: team-standards\n    destination: .custom/agents/\n\noverrides:\n\n  - target: security.md\n    strategy: append\n    file: local/security-extension.md\n\ntransforms:\n\n  - source: base-rules\n    type: template\n    vars:\n      project: \"{{ .project }}\"\n\n  - source: team-standards\n    type: custom\n    command: \"./scripts/merge-yaml.sh\"\n    output_hash: sha256:expected...\n</code></pre>"},{"location":"spec/#32-tool-map","title":"3.2 Tool Map","text":"<p>The tool map provides automatic path resolution for known agent tools.</p>"},{"location":"spec/#built-in-tool-definitions","title":"Built-in Tool Definitions","text":"<p>agent-sync ships with built-in path mappings for known tools:</p> Tool Default Destination cursor .cursor/rules/ claude-code .claude/ copilot .github/copilot/ windsurf .windsurf/rules/ cline .cline/rules/ codex .codex/"},{"location":"spec/#custom-tool-definitions","title":"Custom Tool Definitions","text":"<p>Teams may define custom tools or override built-in paths:</p> <pre><code>tool_definitions:\n\n  - name: internal-agent\n    destination: .internal/agent-config/\n\n  - name: cursor\n    destination: .cursor/custom-rules/\n</code></pre>"},{"location":"spec/#tool-map-resolution-rules","title":"Tool Map Resolution Rules","text":"<ol> <li>If a target specifies <code>tools:</code>, agent-sync resolves each tool name to its destination path.</li> <li>Custom <code>tool_definitions</code> override built-in mappings.</li> <li>If a tool name has no built-in or custom definition, agent-sync MUST error with a clear message indicating the unknown tool and how to define it.</li> <li>If a target specifies <code>destination:</code> directly, no tool map resolution occurs \u2014 the path is used as-is.</li> <li><code>tools:</code> and <code>destination:</code> are mutually exclusive on a single target entry.</li> </ol>"},{"location":"spec/#33-hierarchical-configuration","title":"3.3 Hierarchical Configuration","text":"<p>agent-sync supports three-level hierarchical configuration: system, user, and project. Configs are discovered automatically and merged in order of increasing precedence.</p>"},{"location":"spec/#discovery-paths","title":"Discovery Paths","text":"Level macOS Linux Windows System <code>/etc/agent-sync/agent-sync.yaml</code> <code>/etc/agent-sync/agent-sync.yaml</code> <code>%ProgramData%\\agent-sync\\agent-sync.yaml</code> User <code>~/Library/Application Support/agent-sync/agent-sync.yaml</code> <code>$XDG_CONFIG_HOME/agent-sync/agent-sync.yaml</code> <code>%AppData%\\agent-sync\\agent-sync.yaml</code> Project <code>./agent-sync.yaml</code> <code>./agent-sync.yaml</code> <code>.\\agent-sync.yaml</code> <p>Missing config files at any level are silently skipped.</p>"},{"location":"spec/#merge-semantics","title":"Merge Semantics","text":"<p>When multiple config levels are present, they are merged as follows:</p> Field Strategy <code>version</code> MUST agree across all layers. Mismatch is a fatal error. <code>variables</code> Deep merge. Higher-precedence keys overwrite lower. Unique keys are preserved. <code>sources</code> Merge by <code>name</code>. A source in a higher-precedence layer fully replaces a source with the same name from a lower layer. <code>tool_definitions</code> Merge by <code>name</code>. Same replacement semantics as sources. <code>targets</code> Concatenate. System targets first, then user, then project. <code>overrides</code> Concatenate. Applied in order: system, user, project. <code>transforms</code> Concatenate. Applied in order: system, user, project."},{"location":"spec/#disabling-hierarchical-resolution","title":"Disabling Hierarchical Resolution","text":"<p>The <code>--no-inherit</code> CLI flag or <code>AGENT_SYNC_NO_INHERIT=1</code> environment variable disables hierarchical resolution. When set, only the project-level config is used. This is RECOMMENDED for CI/CD environments to ensure reproducible builds.</p>"},{"location":"spec/#environment-variable-overrides","title":"Environment Variable Overrides","text":"Variable Purpose <code>AGENT_SYNC_SYSTEM_CONFIG</code> Override the system config file path <code>AGENT_SYNC_USER_CONFIG</code> Override the user config file path <code>AGENT_SYNC_NO_INHERIT</code> Set to <code>1</code> or <code>true</code> to disable hierarchical resolution"},{"location":"spec/#4-lockfile-specification","title":"4. Lockfile Specification","text":"<p>File:</p> <pre><code>agent-sync.lock\n</code></pre>"},{"location":"spec/#41-purpose","title":"4.1 Purpose","text":"<p>The lockfile records:</p> <ul> <li>Fully resolved source identity</li> <li>Content hashes</li> <li>Transform output hashes</li> <li>Sync status per source</li> </ul> <p>The lockfile is the authoritative record.</p>"},{"location":"spec/#42-example","title":"4.2 Example","text":"<pre><code>version: 1\n\nsources:\n\n  - name: base-rules\n    type: git\n    repo: https://github.com/org/rules.git\n\n    resolved:\n\n      commit: 3f8c9abf...\n      tree: a8bcdef...\n\n      files:\n\n        core/security.md:\n          sha256: 123abc...\n\n        core/general.md:\n          sha256: 456def...\n\n    status: ok\n\n  - name: security-policy\n    type: url\n\n    resolved:\n\n      url: https://example.com/policy.md\n      sha256: abcdef123...\n\n    status: ok\n\n  - name: team-standards\n    type: local\n\n    resolved:\n\n      path: ./agents/standards/\n\n      files:\n\n        standards/naming.md:\n          sha256: 789ghi...\n\n        standards/testing.md:\n          sha256: 012jkl...\n\n    status: ok\n</code></pre>"},{"location":"spec/#43-lockfile-guarantees","title":"4.3 Lockfile Guarantees","text":"<p>Given the same lockfile, agent-sync MUST produce:</p> <ul> <li>Same inputs</li> <li>Same outputs</li> <li>Same file contents</li> </ul> <p>Byte-for-byte reproducibility is the standard.</p>"},{"location":"spec/#44-partial-update-behavior","title":"4.4 Partial Update Behavior","text":"<p>See Section 9.2 for the authoritative definition of partial update behavior. The lockfile supports partial updates: individual source entries may be updated independently while others remain unchanged.</p>"},{"location":"spec/#5-source-types","title":"5. Source Types","text":""},{"location":"spec/#51-git-source","title":"5.1 Git Source","text":"<p>Example:</p> <pre><code>type: git\nrepo: https://github.com/org/repo.git\nref: v1.2.0\npaths:\n  - folder/\n</code></pre>"},{"location":"spec/#resolution-rules","title":"Resolution Rules","text":"<p>agent-sync MUST resolve and record:</p> <ul> <li>commit SHA</li> <li>tree SHA</li> <li>per-file content hashes</li> </ul> <p><code>ref</code> is a human hint only.</p> <p>The resolved commit SHA is authoritative.</p>"},{"location":"spec/#optional-security-modes-recommended","title":"Optional Security Modes (Recommended)","text":"<p>Implementations SHOULD support:</p> <ul> <li>signed tag verification</li> <li>signed commit verification</li> <li>repository allowlists</li> </ul>"},{"location":"spec/#52-url-source","title":"5.2 URL Source","text":"<p>Example:</p> <pre><code>type: url\nurl: https://example.com/file.md\nchecksum: sha256:abcdef\n</code></pre> <p><code>checksum</code> is REQUIRED.</p> <p>agent-sync MUST verify the fetched content against the declared checksum before accepting it.</p>"},{"location":"spec/#53-local-source","title":"5.3 Local Source","text":"<p>Example:</p> <pre><code>type: local\npath: ./agents/\n</code></pre>"},{"location":"spec/#path-resolution","title":"Path Resolution","text":"<p>Local source <code>path</code> is resolved relative to the project root (the directory containing <code>agent-sync.yaml</code>).</p>"},{"location":"spec/#locking-requirements","title":"Locking Requirements","text":"<p>Local sources MUST be locked by hashing all resolved files.</p> <p>The lockfile MUST record per-file content hashes for local sources, identical in structure to git and url sources.</p> <p>Rationale: local sources that are not hashed break the determinism guarantee. If the lockfile cannot verify local file integrity, drift detection and reproducibility are compromised.</p>"},{"location":"spec/#6-transform-specification","title":"6. Transform Specification","text":"<p>Transforms MUST be deterministic.</p>"},{"location":"spec/#61-template-transform","title":"6.1 Template Transform","text":"<p>Variables substituted using Go <code>text/template</code>.</p> <p>Example:</p> <pre><code>Project: {{ .project }}\n</code></pre>"},{"location":"spec/#security","title":"Security","text":"<p>Template execution:</p> <ul> <li>No file access</li> <li>No network access</li> <li>No code execution</li> </ul> <p>Template input is data only.</p> <p>Implementations SHOULD support disabling templates entirely via configuration.</p>"},{"location":"spec/#62-overrides","title":"6.2 Overrides","text":"<p>Overrides modify target files after sync.</p> <p>Supported strategies:</p> <ul> <li><code>append</code> \u2014 add content after the synced file</li> <li><code>prepend</code> \u2014 add content before the synced file</li> <li><code>replace</code> \u2014 replace the synced file entirely with the override file</li> </ul> <p>Example:</p> <pre><code>overrides:\n  - target: security.md\n    strategy: append\n    file: local/security-extension.md\n</code></pre> <p>Override resolution:</p> <ol> <li>Overrides are applied after all sources are synced.</li> <li>The <code>target</code> field matches against the final destination filename (not source path).</li> <li>If the target file does not exist after sync, the override MUST error.</li> <li>The <code>file</code> path is resolved relative to the project root (the directory containing <code>agent-sync.yaml</code>).</li> <li>The override file itself MUST exist at config validation time \u2014 agent-sync MUST error if it is not found.</li> </ol>"},{"location":"spec/#63-custom-transform-hooks","title":"6.3 Custom Transform Hooks","text":"<p>For transforms beyond template substitution and overrides, agent-sync supports custom transform hooks.</p> <pre><code>transforms:\n  - source: team-standards\n    type: custom\n    command: \"./scripts/merge-yaml.sh\"\n    output_hash: sha256:expected...\n</code></pre>"},{"location":"spec/#custom-transform-rules","title":"Custom Transform Rules","text":"<ol> <li>The command receives the source files via stdin or a temporary directory (implementation-defined).</li> <li>The command MUST produce output to stdout or a temporary output directory (implementation-defined).</li> <li><code>output_hash</code> is OPTIONAL. If provided, agent-sync MUST verify the transform output against it. This enables lockfile-level pinning of transform results.</li> <li>Custom transforms MUST NOT have network access.</li> <li>Custom transforms MUST NOT modify files outside the designated output.</li> <li>If the command exits non-zero, the sync MUST fail for that source.</li> </ol>"},{"location":"spec/#mvp-scope-note","title":"MVP Scope Note","text":"<p>For initial implementation, custom transforms are OPTIONAL. Template substitution and overrides cover the majority of use cases. Custom transforms provide the extension point for advanced workflows without overcomplicating the core.</p>"},{"location":"spec/#64-conflict-rules","title":"6.4 Conflict Rules","text":"<p>Multiple sources targeting the same destination file MUST error unless:</p> <ul> <li>An explicit override is configured for that file, OR</li> <li>The target entries are for different tools (and thus resolve to different paths)</li> </ul>"},{"location":"spec/#7-target-specification","title":"7. Target Specification","text":"<p>Targets define output locations.</p>"},{"location":"spec/#71-tool-based-targets","title":"7.1 Tool-Based Targets","text":"<pre><code>targets:\n  - source: rules\n    tools: [cursor, claude-code]\n</code></pre> <p>Resolves via the tool map (Section 3.2).</p>"},{"location":"spec/#72-explicit-path-targets","title":"7.2 Explicit Path Targets","text":"<pre><code>targets:\n  - source: rules\n    destination: .custom/rules/\n</code></pre> <p>Used for tools without a built-in mapping, or when direct control is needed.</p>"},{"location":"spec/#73-target-rules","title":"7.3 Target Rules","text":"<ol> <li><code>tools</code> and <code>destination</code> are mutually exclusive per target entry.</li> <li>All resolved paths MUST be validated against the sandbox (Section 8.1).</li> <li>If a source defined in config has no matching target entry, agent-sync MUST warn during <code>sync</code> and <code>check</code>. This is not a fatal error \u2014 the source is simply unused.</li> </ol>"},{"location":"spec/#8-security-model","title":"8. Security Model","text":"<p>Security is a core design requirement.</p>"},{"location":"spec/#81-sandbox-guarantee","title":"8.1 Sandbox Guarantee","text":"<p>agent-sync MUST prevent writing outside the project root.</p> <p>Protection MUST include:</p> <ul> <li>Absolute path resolution before any write</li> <li>Symlink resolution and traversal prevention</li> <li>TOCTOU (time-of-check-to-time-of-use) defense via atomic operations</li> <li>Rejection of paths containing <code>..</code> after resolution</li> </ul> <p><code>filepath.Clean</code> alone is NOT sufficient.</p>"},{"location":"spec/#82-safe-write-requirements","title":"8.2 Safe Write Requirements","text":"<p>All file writes MUST:</p> <ul> <li>Use atomic temp file + rename</li> <li>Resolve the real path before writing</li> <li>Reject symlink escapes</li> <li>Verify the final path is within the project root</li> </ul>"},{"location":"spec/#83-integrity-verification","title":"8.3 Integrity Verification","text":"<p>agent-sync MUST verify:</p> <ul> <li>File content hashes against lockfile</li> <li>Lockfile internal consistency (no duplicate entries, no orphaned references)</li> </ul> <p>Verification MUST occur before any file is written to the target.</p>"},{"location":"spec/#84-cache-requirements","title":"8.4 Cache Requirements","text":"<p>Cache MUST be:</p> <ul> <li>Content-addressed</li> <li>Immutable once written</li> <li>Verified (hash-checked) before use</li> </ul>"},{"location":"spec/#85-resource-limits-recommended","title":"8.5 Resource Limits (Recommended)","text":"<p>Implementations SHOULD support configurable limits:</p> <ul> <li><code>max_file_size</code> \u2014 maximum size of any single fetched file</li> <li><code>max_source_size</code> \u2014 maximum total size of files from a single source</li> <li><code>fetch_timeout</code> \u2014 maximum time for any network fetch operation</li> </ul>"},{"location":"spec/#9-cli-specification","title":"9. CLI Specification","text":"<p>Reference CLI commands. The CLI is optional \u2014 all behavior is also available via the Go library (Section 10).</p>"},{"location":"spec/#91-sync","title":"9.1 sync","text":"<p>Synchronize files to targets using the lockfile.</p> <pre><code>agent-sync sync [--dry-run]\n</code></pre> <p>Behavior:</p> <ul> <li>Reads the lockfile as the source of truth.</li> <li>Fetches content from cache or sources as needed.</li> <li>Writes files to target locations.</li> <li>MUST NOT modify the lockfile. (Only <code>update</code> and <code>prune</code> may modify the lockfile.)</li> </ul> <p><code>--dry-run</code> flag:</p> <ul> <li>Shows exactly which files would be written, modified, or removed.</li> <li>Shows the diff for each changed file.</li> <li>Makes no changes to the filesystem.</li> <li>Exits with the same code that a real sync would (0 for clean, non-zero for errors).</li> </ul>"},{"location":"spec/#sync-failure-and-rollback","title":"Sync Failure and Rollback","text":"<p>If sync fails partway through:</p> <ul> <li>Files already written in the current operation MUST be rolled back to their previous state.</li> <li>The lockfile MUST NOT be modified.</li> <li>The CLI MUST report exactly which files were affected and which source caused the failure.</li> <li>Exit non-zero.</li> </ul> <p>Rollback strategy: agent-sync SHOULD snapshot existing target files before beginning a sync operation and restore them on failure.</p>"},{"location":"spec/#92-update","title":"9.2 update","text":"<p>Resolve sources against their upstream and update the lockfile.</p> <pre><code>agent-sync update [source-name...] [--dry-run]\n</code></pre> <p>Behavior:</p> <ul> <li>Resolves each source to its current upstream state.</li> <li>Shows a diff of lockfile changes before applying.</li> <li>Requires interactive confirmation (unless <code>--yes</code> is passed).</li> <li>Updates the lockfile with resolved state.</li> </ul> <p>If <code>source-name</code> arguments are provided, only those sources are updated. Others are left unchanged.</p>"},{"location":"spec/#partial-failure-behavior","title":"Partial Failure Behavior","text":"<p>When updating multiple sources:</p> <ul> <li>Successfully resolved sources MUST be written to the lockfile.</li> <li>Failed sources MUST retain their previous lockfile entry.</li> <li>Each failure MUST be reported with source name and error detail.</li> <li>Exit non-zero if any source failed.</li> </ul>"},{"location":"spec/#93-check","title":"9.3 check","text":"<p>Verify that target files match the lockfile.</p> <pre><code>agent-sync check\n</code></pre> <p>Behavior:</p> <ul> <li>Hashes all target files and compares against the lockfile.</li> <li>Reports any drift (files changed, missing, or unexpected).</li> <li>Exit 0 if everything matches. Exit non-zero on drift.</li> <li>Suitable for CI pipelines.</li> </ul>"},{"location":"spec/#94-verify","title":"9.4 verify","text":"<p>Verify the lockfile against upstream sources.</p> <pre><code>agent-sync verify [source-name...]\n</code></pre> <p>Behavior:</p> <ul> <li>For each source, checks whether the upstream has changed since the lockfile was last written.</li> <li>Reports which sources have newer content available.</li> <li>Does NOT modify the lockfile or target files.</li> <li>Exit 0 if all sources match upstream. Exit non-zero if any source has upstream changes.</li> </ul>"},{"location":"spec/#use-cases","title":"Use Cases","text":"<ul> <li>CI pipeline: \"are we up to date with upstream?\"</li> <li>Security audit: \"has the upstream content changed since we pinned it?\"</li> <li>Pre-update check: \"what would change if I ran update?\"</li> </ul>"},{"location":"spec/#95-status","title":"9.5 status","text":"<p>Show the current state of all synced agents/sources.</p> <pre><code>agent-sync status [source-name...]\n</code></pre> <p>Output includes:</p> <ul> <li>Source name and type</li> <li>Pinned version / commit (from lockfile)</li> <li>Target destinations (resolved tool paths)</li> <li>Sync state: <code>synced</code>, <code>drifted</code>, <code>missing</code>, <code>pending</code></li> <li>Last sync timestamp (if tracked)</li> </ul> <p>Example output:</p> <pre><code>SOURCE           TYPE   PINNED AT       TARGETS                          STATE\nbase-rules       git    v1.2.0 (3f8c9a) .cursor/rules/, .claude/        synced\nsecurity-policy  url    sha256:abcdef   .cursor/policy.md, .claude/...   drifted\nteam-standards   local  (5 files)       .custom/agents/                  synced\n</code></pre>"},{"location":"spec/#96-info","title":"9.6 info","text":"<p>Show information about the agent-sync tool itself.</p> <pre><code>agent-sync info\n</code></pre> <p>Output includes:</p> <ul> <li>agent-sync version</li> <li>Spec version supported</li> <li>Configuration file location (if found)</li> <li>Lockfile location (if found)</li> <li>Cache directory location and size</li> <li>Known tool definitions (built-in + custom)</li> <li>Go library version (if relevant)</li> </ul>"},{"location":"spec/#97-prune","title":"9.7 prune","text":"<p>Remove previously synced files that are no longer referenced in the configuration.</p> <pre><code>agent-sync prune [--dry-run]\n</code></pre> <p>Behavior:</p> <ul> <li>Compares current config targets against files tracked in the lockfile.</li> <li>Removes files that were previously synced but are no longer in the config.</li> <li>Updates the lockfile to remove pruned entries.</li> <li><code>--dry-run</code> shows what would be removed without acting.</li> </ul>"},{"location":"spec/#98-global-flags","title":"9.8 Global Flags","text":"<p>The following flags are available on all commands:</p> <ul> <li><code>--config &lt;path&gt;</code> \u2014 path to config file (default: <code>agent-sync.yaml</code>)</li> <li><code>--lockfile &lt;path&gt;</code> \u2014 path to lockfile (default: <code>agent-sync.lock</code>)</li> <li><code>--verbose</code> \u2014 detailed output</li> <li><code>--quiet</code> \u2014 minimal output (errors only)</li> <li><code>--no-color</code> \u2014 disable colored output</li> <li><code>--no-inherit</code> \u2014 disable hierarchical config resolution (use only the project config)</li> </ul>"},{"location":"spec/#99-environment-variables","title":"9.9 Environment Variables","text":"Variable Purpose <code>AGENT_SYNC_SYSTEM_CONFIG</code> Override the system config file path <code>AGENT_SYNC_USER_CONFIG</code> Override the user config file path <code>AGENT_SYNC_NO_INHERIT</code> Set to <code>1</code> or <code>true</code> to disable hierarchical resolution"},{"location":"spec/#10-library-specification-go","title":"10. Library Specification (Go)","text":"<p>agent-sync MUST be usable as a Go library.</p>"},{"location":"spec/#101-core-interfaces","title":"10.1 Core Interfaces","text":"<pre><code>type Resolver interface {\n    // Resolve resolves sources and returns an updated lockfile.\n    // If sourceNames is non-empty, only those sources are resolved.\n    Resolve(ctx context.Context, config Config, sourceNames []string) (Lockfile, error)\n}\n\ntype Syncer interface {\n    Sync(ctx context.Context, lock Lockfile, config Config, opts SyncOptions) (*SyncResult, error)\n}\n\ntype Checker interface {\n    Check(ctx context.Context, lock Lockfile, config Config) (*CheckResult, error)\n}\n\ntype Verifier interface {\n    // Verify checks whether upstream sources have changed since lockfile was written.\n    Verify(ctx context.Context, lock Lockfile, config Config, sourceNames []string) (*VerifyResult, error)\n}\n\ntype Pruner interface {\n    Prune(ctx context.Context, lock Lockfile, config Config, opts PruneOptions) (*PruneResult, error)\n}\n</code></pre>"},{"location":"spec/#102-result-types","title":"10.2 Result Types","text":"<pre><code>type SyncResult struct {\n    Written  []FileAction\n    Skipped  []FileAction\n    Errors   []SourceError\n}\n\ntype CheckResult struct {\n    Clean   bool\n    Drifted []DriftEntry\n    Missing []string\n}\n\ntype VerifyResult struct {\n    UpToDate []string\n    Changed  []SourceDelta\n    Errors   []SourceError\n}\n\ntype SyncOptions struct {\n    DryRun bool\n}\n\ntype PruneOptions struct {\n    DryRun bool\n}\n\ntype PruneResult struct {\n    Removed []FileAction\n    Errors  []SourceError\n}\n</code></pre>"},{"location":"spec/#103-library-rules","title":"10.3 Library Rules","text":"<ul> <li>Library MUST NOT depend on the CLI.</li> <li>Library MUST accept <code>context.Context</code> for cancellation and timeout.</li> <li>Library MUST return structured errors, not exit codes.</li> <li>All I/O MUST go through interfaces (filesystem, network) to enable testing and embedding.</li> </ul>"},{"location":"spec/#11-determinism-guarantees","title":"11. Determinism Guarantees","text":"<p>Given:</p> <ul> <li>Byte-for-byte identical configuration file</li> <li>Byte-for-byte identical lockfile</li> <li>Same local source files (verified by lockfile hashes)</li> <li>Same override files</li> </ul> <p>agent-sync MUST produce byte-for-byte identical output.</p> <p>This applies to all operations: sync, transforms, and overrides.</p> <p>Non-deterministic behavior is a bug.</p>"},{"location":"spec/#12-deferred-features","title":"12. Deferred Features","text":""},{"location":"spec/#121-install-command-deferred","title":"12.1 Install Command (Deferred)","text":"<p>Future:</p> <pre><code>agent-sync install org/security-agent\n</code></pre> <p>Would:</p> <ul> <li>Resolve a registry</li> <li>Fetch agent configuration</li> <li>Add source entry to config</li> </ul> <p>Registry specification is deferred.</p>"},{"location":"spec/#122-registry-specification-deferred","title":"12.2 Registry Specification (Deferred)","text":"<p>agent-sync core remains registry-agnostic.</p> <p>Registries MUST NOT be required for core functionality.</p>"},{"location":"spec/#13-error-handling","title":"13. Error Handling","text":"<p>agent-sync MUST fail on:</p> <ul> <li>Hash mismatch (source, lockfile, or transform output)</li> <li>Sandbox violation</li> <li>Source integrity failure</li> <li>Ambiguous file writes (multiple sources, no override)</li> <li>Unknown tool name (no built-in or custom definition)</li> <li>Lockfile corruption or schema mismatch</li> </ul> <p>agent-sync MUST NOT silently continue past errors.</p> <p>All errors MUST include:</p> <ul> <li>The source or file that caused the failure</li> <li>The specific validation that failed</li> <li>A suggested remediation where possible</li> </ul>"},{"location":"spec/#14-versioning","title":"14. Versioning","text":""},{"location":"spec/#141-spec-version","title":"14.1 Spec Version","text":"<p>The specification version is declared in both config and lockfile:</p> <pre><code>version: 1\n</code></pre>"},{"location":"spec/#142-version-semantics","title":"14.2 Version Semantics","text":"<ul> <li>The <code>version</code> field is an integer.</li> <li>Each version defines a strict schema. Config and lockfile files MUST validate against the schema for their declared version.</li> <li>agent-sync MUST reject files with an unrecognized version.</li> </ul>"},{"location":"spec/#143-compatibility-rules","title":"14.3 Compatibility Rules","text":"<ul> <li>Patch changes (new optional fields, clarifications): no version bump. Implementations MUST ignore unknown fields gracefully.</li> <li>Breaking changes (removed fields, changed semantics, new required fields): MUST increment the version integer.</li> <li>When a breaking version change occurs, agent-sync MUST provide a migration path \u2014 either an automatic <code>migrate</code> command or clear documentation of manual steps.</li> <li>agent-sync SHOULD support reading the immediately prior version and auto-migrating.</li> </ul>"},{"location":"spec/#15-summary","title":"15. Summary","text":"<p>agent-sync provides:</p> <ul> <li>Deterministic file sync from git, URL, and local sources</li> <li>Secure sandboxed writes with symlink and TOCTOU protection</li> <li>Immutable lockfile with per-file content hashes</li> <li>Tool map for automatic multi-tool path resolution</li> <li>Partial failure resilience with rollback and granular reporting</li> <li>Registry-agnostic core with deferred install/registry</li> <li>Embeddable Go library with clean interfaces</li> <li>CLI with sync, update, check, verify, status, info, and prune commands</li> </ul> <p>agent-sync is a synchronization engine, not an agent platform.</p>"},{"location":"getting-started/installation/","title":"Installation","text":""},{"location":"getting-started/installation/#quick-install-macos-linux","title":"Quick Install (macOS / Linux)","text":"<pre><code>curl -sSL https://raw.githubusercontent.com/bianoble/agent-sync/main/install.sh | sh\n</code></pre> <p>This auto-detects your OS and architecture, downloads the latest release, verifies the SHA256 checksum, and installs to <code>/usr/local/bin</code> (or <code>~/.local/bin</code> if not writable).</p> <p>To install a specific version:</p> <pre><code>curl -sSL https://raw.githubusercontent.com/bianoble/agent-sync/main/install.sh | VERSION=v0.1.0 sh\n</code></pre>"},{"location":"getting-started/installation/#quick-install-windows","title":"Quick Install (Windows)","text":"<pre><code>irm https://raw.githubusercontent.com/bianoble/agent-sync/main/install.ps1 | iex\n</code></pre> <p>Downloads the latest release, verifies the SHA256 checksum, installs to <code>%LOCALAPPDATA%\\agent-sync\\bin</code>, and adds it to your PATH.</p>"},{"location":"getting-started/installation/#pre-built-binaries","title":"Pre-built Binaries","text":"<p>Download the latest release from GitHub Releases.</p> <p>Available platforms:</p> OS Architecture Binary Linux amd64 <code>agent-sync-linux-amd64</code> Linux arm64 <code>agent-sync-linux-arm64</code> macOS amd64 <code>agent-sync-darwin-amd64</code> macOS arm64 <code>agent-sync-darwin-arm64</code> Windows amd64 <code>agent-sync-windows-amd64.exe</code>"},{"location":"getting-started/installation/#go-install","title":"Go Install","text":"<p>With Go 1.24+:</p> <pre><code>go install github.com/bianoble/agent-sync/cmd/agent-sync@latest\n</code></pre>"},{"location":"getting-started/installation/#build-from-source","title":"Build from Source","text":"<pre><code>git clone https://github.com/bianoble/agent-sync.git\ncd agent-sync\nmake build\n</code></pre> <p>The binary will be at <code>./agent-sync</code>.</p>"},{"location":"getting-started/installation/#verify-installation","title":"Verify Installation","text":"<pre><code>agent-sync version\n</code></pre>"},{"location":"getting-started/installation/#go-library","title":"Go Library","text":"<p>To use agent-sync as a Go library:</p> <pre><code>go get github.com/bianoble/agent-sync@latest\n</code></pre> <p>See the Go Library Reference for API documentation.</p>"},{"location":"getting-started/quickstart/","title":"Quick Start","text":"<p>This guide walks through setting up agent-sync in a project.</p>"},{"location":"getting-started/quickstart/#1-initialize-configuration","title":"1. Initialize Configuration","text":"<pre><code>agent-sync init\n</code></pre> <p>This creates an <code>agent-sync.yaml</code> with a commented starter template. Open it and edit the source to point at your repository:</p> <pre><code>version: 1\n\nsources:\n  - name: team-rules\n    type: git\n    repo: https://github.com/your-org/agent-rules.git\n    ref: main\n\ntargets:\n  - source: team-rules\n    tools: [cursor, claude-code]\n</code></pre> <p>This configuration will sync files from the <code>agent-rules</code> repository into both <code>.cursor/rules/</code> and <code>.claude/</code> directories.</p>"},{"location":"getting-started/quickstart/#2-resolve-and-lock","title":"2. Resolve and Lock","text":"<pre><code>agent-sync update\n</code></pre> <p>This resolves the source to its current commit SHA, fetches file content hashes, and writes <code>agent-sync.lock</code>. The lockfile pins the exact state of every file.</p>"},{"location":"getting-started/quickstart/#3-sync-files","title":"3. Sync Files","text":"<pre><code>agent-sync sync\n</code></pre> <p>This writes the locked files to the target directories. The lockfile is the source of truth \u2014 sync never modifies it.</p>"},{"location":"getting-started/quickstart/#4-verify-in-ci","title":"4. Verify in CI","text":"<p>Add to your CI pipeline:</p> <pre><code>agent-sync check\n</code></pre> <p>This exits 0 if all target files match the lockfile, or non-zero if any files have drifted. Use this to enforce that synced files haven't been manually edited.</p> <p>CI Tip</p> <p>Use <code>--no-inherit</code> in CI environments to ignore system/user configs and ensure reproducible builds: <pre><code>agent-sync sync --no-inherit\nagent-sync check --no-inherit\n</code></pre></p>"},{"location":"getting-started/quickstart/#common-workflows","title":"Common Workflows","text":""},{"location":"getting-started/quickstart/#update-a-single-source","title":"Update a Single Source","text":"<pre><code>agent-sync update team-rules\n</code></pre>"},{"location":"getting-started/quickstart/#preview-changes","title":"Preview Changes","text":"<pre><code>agent-sync sync --dry-run\nagent-sync update --dry-run\n</code></pre>"},{"location":"getting-started/quickstart/#check-for-upstream-changes","title":"Check for Upstream Changes","text":"<pre><code>agent-sync verify\n</code></pre> <p>Reports whether upstream sources have changed since the lockfile was written, without modifying anything.</p>"},{"location":"getting-started/quickstart/#view-current-state","title":"View Current State","text":"<pre><code>agent-sync status\n</code></pre> <p>Shows each source's type, pinned version, targets, and sync state.</p>"},{"location":"getting-started/quickstart/#using-local-sources","title":"Using Local Sources","text":"<p>For project-specific rules that live alongside your code:</p> <pre><code>sources:\n  - name: local-rules\n    type: local\n    path: ./agents/rules/\n\ntargets:\n  - source: local-rules\n    tools: [cursor]\n</code></pre> <p>Local sources are still locked by content hash, ensuring drift detection works.</p>"},{"location":"getting-started/quickstart/#using-url-sources","title":"Using URL Sources","text":"<p>For single files:</p> <pre><code>sources:\n  - name: security-policy\n    type: url\n    url: https://example.com/security.md\n    checksum: sha256:abc123...\n\ntargets:\n  - source: security-policy\n    destination: .cursor/rules/\n</code></pre> <p>URL sources require a <code>checksum</code> field for integrity verification.</p>"},{"location":"getting-started/quickstart/#hierarchical-configuration","title":"Hierarchical Configuration","text":"<p>agent-sync supports three config levels that merge together: system, user, and project. This lets you define global skill sets once and add project-specific sources where needed.</p>"},{"location":"getting-started/quickstart/#user-config-applies-to-all-projects","title":"User Config (applies to all projects)","text":"<p>Place at <code>~/Library/Application Support/agent-sync/agent-sync.yaml</code> (macOS) or <code>~/.config/agent-sync/agent-sync.yaml</code> (Linux):</p> <pre><code>version: 1\n\nsources:\n  # Official Anthropic skills (mcp-builder, pdf, skill-creator, etc.)\n  - name: anthropic-skills\n    type: git\n    repo: https://github.com/anthropics/skills.git\n    ref: main\n    paths:\n      - skills/\n\n  # Community skills\n  - name: composio-skills\n    type: git\n    repo: https://github.com/ComposioHQ/awesome-claude-skills.git\n    ref: master\n\ntargets:\n  - source: anthropic-skills\n    tools: [claude-code]\n\n  - source: composio-skills\n    tools: [claude-code]\n</code></pre>"},{"location":"getting-started/quickstart/#project-config-project-specific-additions","title":"Project Config (project-specific additions)","text":"<p>In a specific project, add only the sources relevant to that codebase. The global skills are inherited automatically:</p> <pre><code>version: 1\n\nsources:\n  # Security-focused PR/diff review\n  - name: tob-differential-review\n    type: git\n    repo: https://github.com/trailofbits/skills.git\n    ref: main\n    paths:\n      - plugins/differential-review/\n\n  # Property-based testing guidance\n  - name: tob-property-testing\n    type: git\n    repo: https://github.com/trailofbits/skills.git\n    ref: main\n    paths:\n      - plugins/property-based-testing/\n\ntargets:\n  - source: tob-differential-review\n    tools: [claude-code]\n\n  - source: tob-property-testing\n    tools: [claude-code]\n</code></pre> <p>Running <code>agent-sync info</code> shows the full config chain:</p> <pre><code>$ agent-sync info\nagent-sync dev\n  config chain:\n    system:    /etc/agent-sync/agent-sync.yaml (not found)\n    user:      ~/Library/Application Support/agent-sync/agent-sync.yaml (loaded)\n    project:   agent-sync.yaml (loaded)\n</code></pre> <p>The merged result includes all sources from both levels. See the Enterprise Configuration guide for advanced patterns.</p>"},{"location":"guides/enterprise-config/","title":"Enterprise Configuration for DevSecOps","text":"<p>agent-sync supports hierarchical configuration resolution across three levels \u2014 system, user, and project \u2014 enabling organizations to enforce security baselines, standardize AI agent behavior, and maintain compliance at scale.</p> <p>This guide is written for DevSecOps engineers, security teams, and platform engineers responsible for managing AI coding tools across development teams.</p>"},{"location":"guides/enterprise-config/#overview","title":"Overview","text":"<p>Configuration is loaded and merged from up to three locations, lowest precedence first:</p> Level Purpose Managed by System Organization-wide mandated policies Platform / Security team User Per-developer preferences and defaults Individual developer Project Project-specific sources and targets Project maintainers <p>Higher-precedence configs override lower ones. Project-level always wins.</p>"},{"location":"guides/enterprise-config/#config-file-locations","title":"Config File Locations","text":""},{"location":"guides/enterprise-config/#macos","title":"macOS","text":"Level Path System <code>/etc/agent-sync/agent-sync.yaml</code> User <code>~/Library/Application Support/agent-sync/agent-sync.yaml</code> Project <code>./agent-sync.yaml</code>"},{"location":"guides/enterprise-config/#linux","title":"Linux","text":"Level Path System <code>/etc/agent-sync/agent-sync.yaml</code> User <code>$XDG_CONFIG_HOME/agent-sync/agent-sync.yaml</code> (default: <code>~/.config/agent-sync/agent-sync.yaml</code>) Project <code>./agent-sync.yaml</code>"},{"location":"guides/enterprise-config/#windows","title":"Windows","text":"Level Path System <code>%ProgramData%\\agent-sync\\agent-sync.yaml</code> User <code>%AppData%\\agent-sync\\agent-sync.yaml</code> Project <code>.\\agent-sync.yaml</code>"},{"location":"guides/enterprise-config/#use-case-enforcing-security-baselines","title":"Use Case: Enforcing Security Baselines","text":"<p>A security team can deploy a system-level config that pins approved AI agent rule files to specific reviewed versions. Every project on that machine inherits these sources automatically.</p>"},{"location":"guides/enterprise-config/#system-config-deployed-via-mdmansiblechef","title":"System Config (deployed via MDM/Ansible/Chef)","text":"<pre><code># /etc/agent-sync/agent-sync.yaml\nversion: 1\n\nvariables:\n  org: acme-corp\n  compliance_level: soc2\n\nsources:\n  - name: org-security-rules\n    type: git\n    repo: https://github.com/acme-corp/ai-security-rules.git\n    ref: v2.3.1\n    paths:\n      - policies/\n\n  - name: org-approved-prompts\n    type: url\n    url: https://security.acme-corp.com/approved-prompts.md\n    checksum: sha256:a1b2c3d4e5f6...\n\ntargets:\n  - source: org-security-rules\n    tools: [cursor, claude-code, copilot, windsurf]\n\n  - source: org-approved-prompts\n    tools: [cursor, claude-code]\n\noverrides:\n  - target: security.md\n    strategy: prepend\n    file: /etc/agent-sync/compliance-header.md\n</code></pre>"},{"location":"guides/enterprise-config/#project-config-maintained-by-developers","title":"Project Config (maintained by developers)","text":"<pre><code># ./agent-sync.yaml\nversion: 1\n\nvariables:\n  project: payment-service\n  team: payments\n\nsources:\n  - name: team-rules\n    type: local\n    path: ./agents/rules/\n\ntargets:\n  - source: team-rules\n    tools: [cursor, claude-code]\n</code></pre>"},{"location":"guides/enterprise-config/#merged-result","title":"Merged Result","text":"<p>When a developer runs <code>agent-sync sync</code> in the project directory, the merged config includes:</p> <ul> <li>Sources: <code>org-security-rules</code> + <code>org-approved-prompts</code> (from system) + <code>team-rules</code> (from project)</li> <li>Targets: All targets from both levels</li> <li>Variables: <code>org=acme-corp</code>, <code>compliance_level=soc2</code>, <code>project=payment-service</code>, <code>team=payments</code></li> </ul> <p>The security team's rules are always present. Developers add project-specific rules alongside them.</p>"},{"location":"guides/enterprise-config/#merge-semantics","title":"Merge Semantics","text":"Field Strategy Detail <code>version</code> Must agree Fatal error if system says <code>1</code> and project says <code>2</code> <code>variables</code> Deep merge Higher-precedence keys overwrite; unique keys preserved <code>sources</code> Merge by name Same <code>name</code> in project fully replaces system entry <code>tool_definitions</code> Merge by name Same <code>name</code> in project replaces system entry <code>targets</code> Concatenate System targets first, then user, then project <code>overrides</code> Concatenate Applied in order: system, user, project <code>transforms</code> Concatenate Applied in order: system, user, project <p>Source Override Visibility</p> <p>If a project redefines a source with the same <code>name</code> as a system source, the project's definition completely replaces the system one. This is auditable \u2014 a code review of <code>agent-sync.yaml</code> shows exactly which org sources a project overrides.</p>"},{"location":"guides/enterprise-config/#deploying-system-configs-at-scale","title":"Deploying System Configs at Scale","text":""},{"location":"guides/enterprise-config/#macos-mdm-profiles","title":"macOS (MDM Profiles)","text":"<p>Use Jamf, Mosyle, or Kandji to deploy a configuration profile that places the config file at <code>/etc/agent-sync/agent-sync.yaml</code>:</p> <pre><code># Example install script\nsudo mkdir -p /etc/agent-sync\nsudo cp agent-sync.yaml /etc/agent-sync/agent-sync.yaml\nsudo chmod 644 /etc/agent-sync/agent-sync.yaml\n</code></pre>"},{"location":"guides/enterprise-config/#linux-configuration-management","title":"Linux (Configuration Management)","text":"AnsibleChef <pre><code>- name: Deploy agent-sync system config\n  copy:\n    src: files/agent-sync.yaml\n    dest: /etc/agent-sync/agent-sync.yaml\n    owner: root\n    group: root\n    mode: '0644'\n</code></pre> <pre><code>directory '/etc/agent-sync' do\n  owner 'root'\n  group 'root'\n  mode '0755'\nend\n\ncookbook_file '/etc/agent-sync/agent-sync.yaml' do\n  source 'agent-sync.yaml'\n  owner 'root'\n  group 'root'\n  mode '0644'\nend\n</code></pre>"},{"location":"guides/enterprise-config/#windows-group-policy-sccm","title":"Windows (Group Policy / SCCM)","text":"<p>Deploy the config to <code>C:\\ProgramData\\agent-sync\\agent-sync.yaml</code> using Group Policy file deployment or SCCM application packaging.</p> <pre><code># PowerShell deployment script\n$dir = \"$env:ProgramData\\agent-sync\"\nNew-Item -ItemType Directory -Force -Path $dir\nCopy-Item agent-sync.yaml \"$dir\\agent-sync.yaml\"\n</code></pre>"},{"location":"guides/enterprise-config/#cicd-integration","title":"CI/CD Integration","text":"<p>In CI environments, hierarchical resolution should be disabled for reproducible builds. Use the <code>--no-inherit</code> flag or the environment variable:</p> <pre><code># GitHub Actions\n- name: Sync agent files\n  run: agent-sync sync --no-inherit\n\n# Or via environment variable\n- name: Sync agent files\n  env:\n    AGENT_SYNC_NO_INHERIT: \"1\"\n  run: agent-sync sync\n</code></pre> <p>This ensures CI uses only the project's <code>agent-sync.yaml</code> and is not affected by system or user configs on the runner.</p>"},{"location":"guides/enterprise-config/#environment-variables","title":"Environment Variables","text":"Variable Purpose <code>AGENT_SYNC_SYSTEM_CONFIG</code> Override the system config file path <code>AGENT_SYNC_USER_CONFIG</code> Override the user config file path <code>AGENT_SYNC_NO_INHERIT</code> Set to <code>1</code> or <code>true</code> to disable hierarchical resolution"},{"location":"guides/enterprise-config/#verifying-the-config-chain","title":"Verifying the Config Chain","text":"<p>Use <code>agent-sync info</code> to see which config files are active:</p> <pre><code>$ agent-sync info\nagent-sync v0.5.0\n  spec version:  1\n  config chain:\n    system:    /etc/agent-sync/agent-sync.yaml (loaded)\n    user:      /Users/alice/Library/Application Support/agent-sync/agent-sync.yaml (not found)\n    project:   ./agent-sync.yaml (loaded)\n  lockfile:      agent-sync.lock\n  cache dir:     /Users/alice/.cache/agent-sync\n  cache size:    2.1 MB\n</code></pre> <p>Use <code>--verbose</code> with any command to see detailed merge activity:</p> <pre><code>$ agent-sync sync --verbose\n  config: loaded system /etc/agent-sync/agent-sync.yaml\n  config: user /Users/alice/Library/Application Support/agent-sync/agent-sync.yaml (not found, skipping)\n  config: loaded project ./agent-sync.yaml\n  config: merged 2 layers\n  ...\n</code></pre>"},{"location":"guides/enterprise-config/#compliance-patterns","title":"Compliance Patterns","text":""},{"location":"guides/enterprise-config/#mandatory-security-rules","title":"Mandatory Security Rules","text":"<p>Deploy a system config with sources that reference your organization's approved AI agent rule files. Pin to specific reviewed tags (not branches) for auditability.</p>"},{"location":"guides/enterprise-config/#approved-tool-definitions","title":"Approved Tool Definitions","text":"<p>Use system-level <code>tool_definitions</code> to standardize which tools map to which directories:</p> <pre><code>tool_definitions:\n  - name: cursor\n    destination: .cursor/rules/approved/\n  - name: claude-code\n    destination: .claude/approved/\n</code></pre>"},{"location":"guides/enterprise-config/#audit-trail","title":"Audit Trail","text":"<p>The lockfile (<code>agent-sync.lock</code>) records the exact commit SHA, URL checksums, and file hashes for every synced source. This provides a verifiable audit trail of which agent rules were active at any point in time.</p> <p>Combined with <code>agent-sync check</code> in CI, teams can detect and prevent drift from approved configurations:</p> <pre><code># CI step: fail if agent files have been manually modified\n- name: Check for agent file drift\n  run: agent-sync check\n</code></pre>"},{"location":"guides/enterprise-config/#preventing-override-of-mandated-sources","title":"Preventing Override of Mandated Sources","text":"<p>While projects can technically redefine a system source by using the same <code>name</code>, this is visible in code review. For stricter enforcement, consider:</p> <ol> <li>CI checks: Validate that project configs don't redefine system source names</li> <li>Pre-commit hooks: Reject changes that shadow system sources</li> <li>agent-sync check: Run in CI to verify all expected sources are present with correct versions</li> </ol>"},{"location":"guides/security/","title":"Security Model","text":"<p>Security is a core design requirement of agent-sync.</p>"},{"location":"guides/security/#sandbox-guarantee","title":"Sandbox Guarantee","text":"<p>agent-sync prevents writing outside the project root. Protection includes:</p> <ul> <li>Absolute path resolution before any write</li> <li>Symlink resolution and traversal prevention</li> <li>TOCTOU defense via atomic operations</li> <li>Path validation \u2014 paths containing <code>..</code> are rejected after resolution</li> </ul> <p><code>filepath.Clean</code> alone is not sufficient \u2014 agent-sync resolves the real path through symlinks.</p>"},{"location":"guides/security/#safe-write","title":"Safe Write","text":"<p>All file writes use atomic operations:</p> <ol> <li>Write content to a temporary file in the target directory</li> <li>Sync the temporary file to disk (<code>fsync</code>)</li> <li>Rename the temporary file to the final path (atomic on POSIX)</li> <li>Verify the final path is within the project root</li> </ol> <p>This prevents partial writes and ensures file integrity.</p>"},{"location":"guides/security/#content-integrity","title":"Content Integrity","text":""},{"location":"guides/security/#lockfile-hashing","title":"Lockfile Hashing","text":"<p>Every file is tracked by its SHA256 content hash in the lockfile. This enables:</p> <ul> <li>Drift detection: <code>check</code> compares target file hashes against the lockfile</li> <li>Cache verification: Cached content is re-verified before use</li> <li>Determinism: Same lockfile always produces identical output</li> </ul>"},{"location":"guides/security/#url-checksum-verification","title":"URL Checksum Verification","text":"<p>URL sources require a <code>checksum</code> field:</p> <pre><code>sources:\n  - name: policy\n    type: url\n    url: https://example.com/file.md\n    checksum: sha256:abcdef...\n</code></pre> <p>Fetched content is verified against the declared checksum before acceptance.</p>"},{"location":"guides/security/#cache-integrity","title":"Cache Integrity","text":"<p>The content-addressed cache:</p> <ul> <li>Stores files by their SHA256 hash</li> <li>Is immutable once written</li> <li>Re-verifies hashes on retrieval (self-healing on corruption)</li> </ul>"},{"location":"guides/security/#rollback-on-failure","title":"Rollback on Failure","text":"<p>If <code>sync</code> fails partway through:</p> <ol> <li>Files already written are rolled back to their previous state</li> <li>The lockfile is never modified</li> <li>The error report includes which files were affected and which source caused the failure</li> </ol>"},{"location":"guides/security/#template-security","title":"Template Security","text":"<p>Template transforms are sandboxed:</p> <ul> <li>No file access</li> <li>No network access</li> <li>No code execution</li> <li>Missing variables produce errors (not empty strings)</li> </ul>"},{"location":"guides/toolmap/","title":"Tool Map","text":"<p>The tool map resolves tool names in target definitions to filesystem paths.</p>"},{"location":"guides/toolmap/#built-in-tools","title":"Built-in Tools","text":"Tool Destination <code>cursor</code> <code>.cursor/rules/</code> <code>claude-code</code> <code>.claude/</code> <code>copilot</code> <code>.github/copilot/</code> <code>windsurf</code> <code>.windsurf/rules/</code> <code>cline</code> <code>.cline/rules/</code> <code>codex</code> <code>.codex/</code>"},{"location":"guides/toolmap/#using-tools-in-targets","title":"Using Tools in Targets","text":"<pre><code>targets:\n  - source: team-rules\n    tools: [cursor, claude-code]\n</code></pre> <p>This writes files from <code>team-rules</code> to both <code>.cursor/rules/</code> and <code>.claude/</code>.</p>"},{"location":"guides/toolmap/#custom-tool-definitions","title":"Custom Tool Definitions","text":"<p>Define custom tools to extend or override the built-in mappings:</p> <pre><code>tool_definitions:\n  - name: my-agent\n    destination: .my-agent/config/\n</code></pre> <p>Custom definitions override built-in ones if the name matches:</p> <pre><code>tool_definitions:\n  - name: cursor\n    destination: .cursor/custom-path/\n</code></pre>"},{"location":"guides/toolmap/#resolution-rules","title":"Resolution Rules","text":"<ol> <li><code>tools:</code> on a target resolves each tool name to its destination path</li> <li>Custom definitions take precedence over built-in ones</li> <li>Unknown tool names produce an error with guidance on how to define it</li> <li><code>destination:</code> on a target is used as-is (no tool map lookup)</li> <li><code>tools:</code> and <code>destination:</code> are mutually exclusive per target entry</li> </ol>"},{"location":"guides/toolmap/#explicit-paths","title":"Explicit Paths","text":"<p>For tools without built-in support, use <code>destination:</code> directly:</p> <pre><code>targets:\n  - source: team-rules\n    destination: .custom/agents/\n</code></pre>"},{"location":"guides/transforms/","title":"Transforms","text":"<p>Transforms modify file content during sync. All transforms are deterministic \u2014 the same inputs always produce the same outputs.</p>"},{"location":"guides/transforms/#template-transform","title":"Template Transform","text":"<p>Substitutes variables using Go <code>text/template</code> syntax.</p>"},{"location":"guides/transforms/#configuration","title":"Configuration","text":"<pre><code>variables:\n  project: my-app\n  team: platform\n\ntransforms:\n  - source: team-rules\n    type: template\n    vars:\n      env: production\n</code></pre>"},{"location":"guides/transforms/#template-syntax","title":"Template Syntax","text":"<p>In source files:</p> <pre><code>Project: {{ .project }}\nTeam: {{ .team }}\nEnvironment: {{ .env }}\n</code></pre> <p>Variables are merged: per-transform <code>vars</code> override global <code>variables</code>.</p>"},{"location":"guides/transforms/#security","title":"Security","text":"<p>Template execution is sandboxed:</p> <ul> <li>No file access</li> <li>No network access</li> <li>No code execution</li> <li>Template input is data only</li> </ul> <p>Binary files (containing null bytes or non-UTF8 content) are skipped.</p>"},{"location":"guides/transforms/#overrides","title":"Overrides","text":"<p>Overrides modify target files after all sources are synced.</p>"},{"location":"guides/transforms/#strategies","title":"Strategies","text":"Strategy Behavior <code>append</code> Add content after the synced file <code>prepend</code> Add content before the synced file <code>replace</code> Replace the synced file entirely"},{"location":"guides/transforms/#configuration_1","title":"Configuration","text":"<pre><code>overrides:\n  - target: security.md\n    strategy: append\n    file: local/security-extension.md\n</code></pre>"},{"location":"guides/transforms/#rules","title":"Rules","text":"<ol> <li>Overrides are applied after all sources are synced</li> <li><code>target</code> matches against the final destination filename (not source path)</li> <li>The target file must exist after sync \u2014 otherwise it's an error</li> <li><code>file</code> is resolved relative to the project root</li> <li>The override file must exist at config validation time</li> </ol>"},{"location":"guides/transforms/#example-appending-local-rules","title":"Example: Appending Local Rules","text":"<pre><code># Sync shared security policy, then append team-specific additions\nsources:\n  - name: security\n    type: git\n    repo: https://github.com/org/policies.git\n    ref: v2.0\n\ntargets:\n  - source: security\n    tools: [cursor]\n\noverrides:\n  - target: policy.md\n    strategy: append\n    file: local/team-policy-additions.md\n</code></pre>"},{"location":"guides/transforms/#conflict-rules","title":"Conflict Rules","text":"<p>Multiple sources targeting the same destination file produce an error unless:</p> <ul> <li>An explicit override is configured for that file, or</li> <li>The target entries are for different tools (and thus resolve to different paths)</li> </ul>"},{"location":"reference/cli/","title":"CLI Reference","text":""},{"location":"reference/cli/#global-flags","title":"Global Flags","text":"<p>These flags are available on all commands:</p> Flag Default Description <code>--config &lt;path&gt;</code> <code>agent-sync.yaml</code> Path to config file <code>--lockfile &lt;path&gt;</code> <code>agent-sync.lock</code> Path to lockfile <code>--verbose</code> <code>false</code> Detailed output <code>--quiet</code> <code>false</code> Minimal output (errors only) <code>--no-color</code> <code>false</code> Disable colored output <code>--no-inherit</code> <code>false</code> Disable hierarchical config resolution (use only the project config)"},{"location":"reference/cli/#commands","title":"Commands","text":""},{"location":"reference/cli/#init","title":"init","text":"<p>Create a starter <code>agent-sync.yaml</code> configuration file.</p> <pre><code>agent-sync init [--force]\n</code></pre> <ul> <li>Writes a well-commented template with a git source example and documented alternatives</li> <li>Respects the <code>--config</code> global flag for output path</li> <li>Refuses to overwrite an existing file unless <code>--force</code> is given</li> </ul> <p>Flags:</p> Flag Description <code>--force</code> Overwrite existing config file"},{"location":"reference/cli/#sync","title":"sync","text":"<p>Synchronize files to targets using the lockfile.</p> <pre><code>agent-sync sync [--dry-run]\n</code></pre> <ul> <li>Reads the lockfile as the source of truth</li> <li>Fetches content from cache or sources as needed</li> <li>Writes files to target locations</li> <li>Does not modify the lockfile</li> </ul> <p>Flags:</p> Flag Description <code>--dry-run</code> Show what would change without writing files <p>Rollback: If sync fails partway through, files already written are rolled back to their previous state.</p>"},{"location":"reference/cli/#update","title":"update","text":"<p>Resolve sources against upstream and update the lockfile.</p> <pre><code>agent-sync update [source-name...] [--dry-run] [--yes]\n</code></pre> <ul> <li>Resolves each source to its current upstream state</li> <li>Shows a diff of lockfile changes before applying</li> <li>Requires interactive confirmation (unless <code>--yes</code>)</li> <li>Updates the lockfile with resolved state</li> </ul> <p>If source names are provided, only those sources are updated.</p> <p>Flags:</p> Flag Description <code>--dry-run</code> Show what would change without updating the lockfile <code>--yes</code> Skip interactive confirmation <p>Partial failure: Successfully resolved sources are written; failed sources retain their previous lockfile entry. Exit non-zero if any failed.</p>"},{"location":"reference/cli/#check","title":"check","text":"<p>Verify that target files match the lockfile.</p> <pre><code>agent-sync check\n</code></pre> <ul> <li>Hashes all target files and compares against the lockfile</li> <li>Reports any drift (files changed, missing, or unexpected)</li> <li>Exit 0 if everything matches; exit non-zero on drift</li> </ul> <p>Suitable for CI pipelines.</p>"},{"location":"reference/cli/#verify","title":"verify","text":"<p>Verify the lockfile against upstream sources.</p> <pre><code>agent-sync verify [source-name...]\n</code></pre> <ul> <li>Checks whether upstream has changed since the lockfile was written</li> <li>Reports which sources have newer content available</li> <li>Does not modify the lockfile or target files</li> <li>Exit 0 if all match; exit non-zero if changes are available</li> </ul>"},{"location":"reference/cli/#status","title":"status","text":"<p>Show the current state of all synced sources.</p> <pre><code>agent-sync status [source-name...]\n</code></pre> <p>Output columns:</p> Column Description SOURCE Source name TYPE <code>git</code>, <code>url</code>, or <code>local</code> PINNED AT Lockfile version/commit TARGETS Resolved destination paths STATE <code>synced</code>, <code>drifted</code>, <code>missing</code>, <code>pending</code>"},{"location":"reference/cli/#info","title":"info","text":"<p>Show information about the agent-sync installation.</p> <pre><code>agent-sync info\n</code></pre> <p>Displays version, spec version, config/lockfile paths, cache directory and size, and known tool definitions.</p>"},{"location":"reference/cli/#prune","title":"prune","text":"<p>Remove files no longer referenced in the configuration.</p> <pre><code>agent-sync prune [--dry-run]\n</code></pre> <ul> <li>Compares current config targets against lockfile-tracked files</li> <li>Removes files that were previously synced but are no longer in the config</li> </ul> <p>Flags:</p> Flag Description <code>--dry-run</code> Show what would be removed without acting"},{"location":"reference/cli/#version","title":"version","text":"<p>Print version information.</p> <pre><code>agent-sync version\n</code></pre>"},{"location":"reference/cli/#exit-codes","title":"Exit Codes","text":"Code Meaning 0 Success 1 Error or drift detected"},{"location":"reference/cli/#environment-variables","title":"Environment Variables","text":"Variable Description <code>AGENT_SYNC_SYSTEM_CONFIG</code> Override the system config file path <code>AGENT_SYNC_USER_CONFIG</code> Override the user config file path <code>AGENT_SYNC_NO_INHERIT</code> Set to <code>1</code> or <code>true</code> to disable hierarchical config resolution"},{"location":"reference/config/","title":"Configuration Reference","text":"<p>The <code>agent-sync.yaml</code> file defines sources, targets, transforms, and overrides.</p>"},{"location":"reference/config/#top-level-structure","title":"Top-Level Structure","text":"<pre><code>version: 1\n\nsources:\n  - name: ...\n    type: git | url | local\n    # type-specific fields\n\ntargets:\n  - source: ...\n    tools: [...]     # OR\n    destination: ... # mutually exclusive with tools\n\nvariables:\n  key: value\n\ntransforms:\n  - source: ...\n    type: template\n    vars:\n      key: value\n\noverrides:\n  - target: filename\n    strategy: append | prepend | replace\n    file: path/to/override\n\ntool_definitions:\n  - name: tool-name\n    destination: .tool/path/\n</code></pre>"},{"location":"reference/config/#configuration-discovery","title":"Configuration Discovery","text":"<p>agent-sync supports hierarchical configuration across three levels, merged lowest-precedence first:</p> Level macOS Linux Windows System <code>/etc/agent-sync/agent-sync.yaml</code> <code>/etc/agent-sync/agent-sync.yaml</code> <code>%ProgramData%\\agent-sync\\agent-sync.yaml</code> User <code>~/Library/Application Support/agent-sync/agent-sync.yaml</code> <code>$XDG_CONFIG_HOME/agent-sync/agent-sync.yaml</code> <code>%AppData%\\agent-sync\\agent-sync.yaml</code> Project <code>./agent-sync.yaml</code> <code>./agent-sync.yaml</code> <code>.\\agent-sync.yaml</code>"},{"location":"reference/config/#merge-semantics","title":"Merge Semantics","text":"Field Strategy <code>version</code> Must agree across all layers <code>variables</code> Deep merge (higher-precedence key wins) <code>sources</code> Merge by <code>name</code> (project replaces system/user entry with same name) <code>tool_definitions</code> Merge by <code>name</code> <code>targets</code> Concatenate (system first, then user, then project) <code>overrides</code> Concatenate <code>transforms</code> Concatenate <p>Use <code>--no-inherit</code> or <code>AGENT_SYNC_NO_INHERIT=1</code> to disable hierarchical resolution (recommended for CI).</p> <p>See the Enterprise Configuration guide for deployment patterns, compliance, and advanced examples.</p>"},{"location":"reference/config/#sources","title":"Sources","text":""},{"location":"reference/config/#git-source","title":"Git Source","text":"<pre><code>sources:\n  - name: team-rules\n    type: git\n    repo: https://github.com/org/repo.git\n    ref: v1.0.0\n    paths:\n      - rules/\n</code></pre> Field Required Description <code>name</code> Yes Unique identifier for this source <code>type</code> Yes Must be <code>git</code> <code>repo</code> Yes Git repository URL <code>ref</code> Yes Branch, tag, or commit (human hint; resolved commit SHA is authoritative) <code>paths</code> No Filter to specific paths within the repo"},{"location":"reference/config/#url-source","title":"URL Source","text":"<pre><code>sources:\n  - name: policy\n    type: url\n    url: https://example.com/file.md\n    checksum: sha256:abcdef...\n</code></pre> Field Required Description <code>name</code> Yes Unique identifier <code>type</code> Yes Must be <code>url</code> <code>url</code> Yes HTTPS URL to fetch <code>checksum</code> Yes <code>sha256:&lt;hex&gt;</code> checksum for integrity verification"},{"location":"reference/config/#local-source","title":"Local Source","text":"<pre><code>sources:\n  - name: local-rules\n    type: local\n    path: ./agents/rules/\n</code></pre> Field Required Description <code>name</code> Yes Unique identifier <code>type</code> Yes Must be <code>local</code> <code>path</code> Yes Path relative to the project root"},{"location":"reference/config/#targets","title":"Targets","text":"<p>Each target maps a source to one or more destinations.</p>"},{"location":"reference/config/#tool-based-targets","title":"Tool-Based Targets","text":"<pre><code>targets:\n  - source: team-rules\n    tools: [cursor, claude-code, copilot]\n</code></pre> <p>Tool names are resolved via the tool map.</p>"},{"location":"reference/config/#explicit-path-targets","title":"Explicit Path Targets","text":"<pre><code>targets:\n  - source: team-rules\n    destination: .custom/agents/\n</code></pre> <p>Warning</p> <p><code>tools</code> and <code>destination</code> are mutually exclusive on a single target entry.</p>"},{"location":"reference/config/#variables","title":"Variables","text":"<p>Global variables available to template transforms:</p> <pre><code>variables:\n  project: my-app\n  team: platform\n</code></pre>"},{"location":"reference/config/#transforms","title":"Transforms","text":"<p>See the Transforms Guide for details.</p> <pre><code>transforms:\n  - source: team-rules\n    type: template\n    vars:\n      project: my-app\n</code></pre>"},{"location":"reference/config/#overrides","title":"Overrides","text":"<p>See the Transforms Guide for details.</p> <pre><code>overrides:\n  - target: security.md\n    strategy: append\n    file: local/security-extension.md\n</code></pre>"},{"location":"reference/config/#tool-definitions","title":"Tool Definitions","text":"<p>Custom tool definitions override or extend built-in mappings:</p> <pre><code>tool_definitions:\n  - name: my-tool\n    destination: .my-tool/config/\n</code></pre>"},{"location":"reference/config/#validation-rules","title":"Validation Rules","text":"<ul> <li><code>version</code> must be <code>1</code></li> <li>Source names must be unique</li> <li>Each source type requires its specific fields</li> <li><code>tools</code> and <code>destination</code> are mutually exclusive per target</li> <li>Override <code>strategy</code> must be <code>append</code>, <code>prepend</code>, or <code>replace</code></li> <li>Override <code>file</code> must exist at validation time</li> <li>Unknown fields are ignored (forward compatibility)</li> </ul>"},{"location":"reference/library/","title":"Go Library Reference","text":"<p>agent-sync is usable as a Go library via the <code>pkg/agentsync</code> package.</p>"},{"location":"reference/library/#installation","title":"Installation","text":"<pre><code>go get github.com/bianoble/agent-sync@latest\n</code></pre>"},{"location":"reference/library/#quick-start","title":"Quick Start","text":"<pre><code>package main\n\nimport (\n    \"context\"\n    \"fmt\"\n    \"log\"\n\n    \"github.com/bianoble/agent-sync/pkg/agentsync\"\n)\n\nfunc main() {\n    client, err := agentsync.New(agentsync.Options{\n        ProjectRoot: \".\",\n        ConfigPath:  \"agent-sync.yaml\",\n    })\n    if err != nil {\n        log.Fatal(err)\n    }\n\n    ctx := context.Background()\n\n    // Update lockfile from upstream sources\n    updateResult, err := client.Update(ctx, agentsync.UpdateOptions{})\n    if err != nil {\n        log.Fatal(err)\n    }\n    fmt.Printf(\"Updated %d sources\\n\", len(updateResult.Updated))\n\n    // Sync files to targets\n    syncResult, err := client.Sync(ctx, agentsync.SyncOptions{})\n    if err != nil {\n        log.Fatal(err)\n    }\n    fmt.Printf(\"Written: %d, Skipped: %d\\n\",\n        len(syncResult.Written), len(syncResult.Skipped))\n\n    // Check for drift\n    checkResult, err := client.Check(ctx)\n    if err != nil {\n        log.Fatal(err)\n    }\n    if checkResult.Clean {\n        fmt.Println(\"All files match lockfile\")\n    }\n}\n</code></pre>"},{"location":"reference/library/#client-options","title":"Client Options","text":"<pre><code>type Options struct {\n    ProjectRoot      string // Directory containing agent-sync.yaml\n    ConfigPath       string // Default: \"agent-sync.yaml\"\n    LockfilePath     string // Default: \"agent-sync.lock\"\n    CacheDir         string // Default: ~/.cache/agent-sync\n    SystemConfigPath string // Override system config path (default: OS-specific)\n    UserConfigPath   string // Override user config path (default: OS-specific)\n    NoInherit        bool   // Disable hierarchical config resolution\n}\n</code></pre> <p>By default, <code>Client</code> uses hierarchical config resolution to merge system, user, and project configs. Set <code>NoInherit: true</code> to use only the project config (recommended for CI and testing).</p>"},{"location":"reference/library/#interfaces","title":"Interfaces","text":"<p>The <code>Client</code> type implements all of these interfaces:</p>"},{"location":"reference/library/#syncer","title":"Syncer","text":"<pre><code>type Syncer interface {\n    Sync(ctx context.Context, opts SyncOptions) (*SyncResult, error)\n}\n</code></pre>"},{"location":"reference/library/#checker","title":"Checker","text":"<pre><code>type Checker interface {\n    Check(ctx context.Context) (*CheckResult, error)\n}\n</code></pre>"},{"location":"reference/library/#verifier","title":"Verifier","text":"<pre><code>type Verifier interface {\n    Verify(ctx context.Context, sourceNames []string) (*VerifyResult, error)\n}\n</code></pre>"},{"location":"reference/library/#pruner","title":"Pruner","text":"<pre><code>type Pruner interface {\n    Prune(ctx context.Context, opts PruneOptions) (*PruneResult, error)\n}\n</code></pre>"},{"location":"reference/library/#updater","title":"Updater","text":"<pre><code>type Updater interface {\n    Update(ctx context.Context, opts UpdateOptions) (*UpdateResult, error)\n}\n</code></pre>"},{"location":"reference/library/#result-types","title":"Result Types","text":""},{"location":"reference/library/#syncresult","title":"SyncResult","text":"<pre><code>type SyncResult struct {\n    Written []FileAction  // Files that were written or modified\n    Skipped []FileAction  // Files that were unchanged\n    Errors  []SourceError // Per-source errors\n}\n</code></pre>"},{"location":"reference/library/#checkresult","title":"CheckResult","text":"<pre><code>type CheckResult struct {\n    Clean   bool         // True if all files match\n    Drifted []DriftEntry // Files that have changed\n    Missing []string     // Files that are missing\n    Errors  []error      // Non-fatal read errors (e.g., permission denied)\n}\n</code></pre>"},{"location":"reference/library/#verifyresult","title":"VerifyResult","text":"<pre><code>type VerifyResult struct {\n    UpToDate []string      // Sources matching upstream\n    Changed  []SourceDelta // Sources with upstream changes\n    Errors   []SourceError // Resolution errors\n}\n</code></pre>"},{"location":"reference/library/#pruneresult","title":"PruneResult","text":"<pre><code>type PruneResult struct {\n    Removed []FileAction  // Files that were removed\n    Errors  []SourceError // Per-source errors\n}\n</code></pre>"},{"location":"reference/library/#library-rules","title":"Library Rules","text":"<ul> <li>The library does not depend on the CLI</li> <li>All methods accept <code>context.Context</code> for cancellation and timeout</li> <li>All methods return structured errors, not exit codes</li> <li>Update operations auto-confirm (no interactive prompts)</li> </ul>"},{"location":"reference/lockfile/","title":"Lockfile Reference","text":"<p>The <code>agent-sync.lock</code> file records the fully resolved, immutable state of all sources. It is the single source of truth for <code>sync</code> and <code>check</code> operations.</p>"},{"location":"reference/lockfile/#structure","title":"Structure","text":"<pre><code>version: 1\nsources:\n  - name: team-rules\n    type: git\n    repo: https://github.com/org/repo.git\n    resolved:\n      commit: abc123...\n      tree: def456...\n      files:\n        rules/general.md:\n          sha256: 789abc...\n        rules/security.md:\n          sha256: 012def...\n    status: ok\n</code></pre>"},{"location":"reference/lockfile/#fields","title":"Fields","text":""},{"location":"reference/lockfile/#top-level","title":"Top Level","text":"Field Type Description <code>version</code> int Must be <code>1</code> <code>sources</code> list Resolved source entries"},{"location":"reference/lockfile/#source-entry","title":"Source Entry","text":"Field Type Description <code>name</code> string Source identifier (matches config) <code>type</code> string <code>git</code>, <code>url</code>, or <code>local</code> <code>repo</code> string Repository URL (git only) <code>resolved</code> object Type-specific resolved state <code>status</code> string Resolution status"},{"location":"reference/lockfile/#resolved-state-git","title":"Resolved State (Git)","text":"Field Type Description <code>commit</code> string Full commit SHA <code>tree</code> string Tree SHA <code>files</code> map Relative path to file hash"},{"location":"reference/lockfile/#resolved-state-url","title":"Resolved State (URL)","text":"Field Type Description <code>url</code> string Fetched URL <code>sha256</code> string Content hash <code>files</code> map Relative path to file hash"},{"location":"reference/lockfile/#resolved-state-local","title":"Resolved State (Local)","text":"Field Type Description <code>path</code> string Resolved path <code>files</code> map Relative path to file hash"},{"location":"reference/lockfile/#rules","title":"Rules","text":"<ul> <li>Only <code>update</code> and <code>prune</code> may modify the lockfile</li> <li><code>sync</code> reads the lockfile but never writes to it</li> <li>Per-file SHA256 hashes enable drift detection and cache lookup</li> <li>The resolved commit SHA (not the config <code>ref</code>) is authoritative for git sources</li> <li>Duplicate source entries are not allowed</li> </ul>"}]}